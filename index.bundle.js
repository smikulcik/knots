(()=>{"use strict";var t={523:(t,e,n)=>{n.d(e,{A:()=>c});var o=n(601),s=n.n(o),i=n(314),r=n.n(i)()(s());r.push([t.id,"",""]);const c=r},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(o)for(var c=0;c<this.length;c++){var h=this[c][0];null!=h&&(r[h]=!0)}for(var a=0;a<t.length;a++){var u=[].concat(t[a]);o&&r[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),e.push(u))}},e}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var i={},r=[],c=0;c<t.length;c++){var h=t[c],a=o.base?h[0]+o.base:h[0],u=i[a]||0,l="".concat(a," ").concat(u);i[a]=u+1;var d=n(l),f={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var y=s(f,o);o.byIndex=c,e.splice(c,0,{identifier:l,updater:y,references:1})}r.push(l)}return r}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var i=o(t=t||[],s=s||{});return function(t){t=t||[];for(var r=0;r<i.length;r++){var c=n(i[r]);e[c].references--}for(var h=o(t,s),a=0;a<i.length;a++){var u=n(i[a]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}i=h}}},659:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,s&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var i=e[o]={id:o,exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{function t(t,e,n,o){t.beginPath(),t.arc(e.x,e.y,n,0,2*Math.PI,!1),t.fillStyle=o,t.fill()}function e(t,e,n,s,i){return o(t,[e,e,n,n],s,i)}function o(t,e,n,o){const[s,i,r,c]=e;t.beginPath(),t.moveTo(s.x,s.y),t.lineCap="round",t.lineWidth=n,t.strokeStyle=o,t.bezierCurveTo(i.x,i.y,r.x,r.y,c.x,c.y),t.stroke()}function s(t){let e;if(t instanceof TouchEvent)return{x:t.changedTouches?.[0].pageX,y:t.changedTouches?.[0].pageY};if(t instanceof MouseEvent)return e=t.toElement.getBoundingClientRect(),{x:t.clientX-e.left,y:t.clientY-e.top};throw new Error("Unknown event type",t)}class i{constructor(t,e,n,o){this.x=t,this.y=e,this.color=n,this.radius=o}draw(e){t(e,{x:this.x,y:this.y},this.radius,this.color)}}function r(t,e){return t.x*e.y-t.y*e.x}function c(t){const e=l(t);return{x:t.x/e,y:t.y/e,z:(t.z||0)/e}}function h(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z?t.z-e.z:0}}function a(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z?t.z+e.z:0}}function u(t,e){return{x:e.x*t,y:e.y*t,z:e.z?e.z*t:0}}function l(t){return Math.sqrt(t.x*t.x+t.y*t.y+(t.z*t.z||0))}function d(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+((e.z||0)-(t.z||0))*((e.z||0)-(t.z||0)))}function f(t,e,n,o){let s=t,i=h(e,t),c=n,l=h(o,n);if(!function(t,e,n,o){const s=a(t,u(.5,e)),i=a(t,u(.5,e));return!(Math.abs(s.x-i.x)>(Math.abs(e.x)+Math.abs(o.x))/2||Math.abs(s.y-i.y)>(Math.abs(e.y)+Math.abs(o.y))/2)}(s,i,0,l))return null;const d=h(c,s),f=r(i,l),y=r(d,i),p=r(d,l);if(0==r(i,l))return null;if(0==y)return null;let x=p/f,v=y/f;return 0<=x&&x<=1&&0<=v&&v<=1?a(s,u(x,i)):null}function y(t,e,n){const o=function(t,e,n){const o=(i=n,((s=h(t,e)).x*i.x+s.y*i.y+(s.z*i.z||0))/l(n));var s,i;const r=c(n);return{x:e.x+r.x*o,y:e.y+r.y*o}}(n,t,h(e,t));let s=(o.x-t.x)/h(e,t).x;return isNaN(s)&&(s=(o.y-t.y)/h(e,t).y),s>1?e:s<0?t:o}function p(t,e){let n,o;for(let s=0;s<t.length;s++){const i=y(t[s],t[(s+1)%t.length],e),r=d(i,e);(void 0===o||r<o)&&(n=i,o=r)}return n}class x{constructor(t){this.edge=t,this.strands=[],this.heights=[],this.crossovers=[],this.cursor,this.cursorDown=!1,this.curHeight}draw(n){for(let t=0;t<this.edge.length-1;t++)e(n,this.edge[t],this.edge[t+1],2,"#000000");e(n,this.edge[this.edge.length-1],this.edge[0],2,"#000000");for(let t=0;t<this.strands.length;t++){for(let o=0;o<this.strands[t].length-2;o++)1!==this.heights[t]?.[o]&&e(n,this.strands[t][o],this.strands[t][o+1],30,"#000000");for(let o=0;o<this.strands[t].length-2;o++)1!==this.heights[t]?.[o]&&e(n,this.strands[t][o],this.strands[t][o+1],27,"#ffffff")}for(let t=0;t<this.strands.length;t++){for(let o=0;o<this.strands[t].length-2;o++)1===this.heights[t]?.[o-1]&&1===this.heights[t]?.[o]&&1===this.heights[t]?.[o+1]&&e(n,this.strands[t][o],this.strands[t][o+1],30,"#000000");for(let o=0;o<this.strands[t].length-2;o++)1===this.heights[t]?.[o]&&e(n,this.strands[t][o],this.strands[t][o+1],27,"#ffffff")}if(this.cursor){const e=p(this.edge,this.cursor);d(e,this.cursor)<20&&t(n,e,15,"#0000aa")}}onmousedown(t){const e=p(this.edge,this.cursor);d(e,this.cursor)<20&&(this.cursorDown=!0,this.strands.push([e]))}onmousemove(t){if(this.cursor=s(t),this.cursorDown){if(!function(t,e){const n={x:Number.MAX_SAFE_INTEGER,y:0};let o=0;for(let s=0;s<e.length;s++)null!==f(e[s],e[(s+1)%e.length],t,a(t,n))&&o++;return o%2==1}(this.cursor,this.edge)){const t=p(this.edge,this.cursor);return void this.addPointToActiveStrand(t)}this.addPointToActiveStrand(this.cursor)}}addPointToActiveStrand(t){const e=this.strands[this.strands.length-1],n=e[e.length-1];var o,s;if(void 0!==n&&(s=n,(o=t).x===s.x&&o.y===s.y&&(o.z||0)===(s.z||0))||e.push({x:t.x,y:t.y}),void 0!==n){let o=!1;const s=e.length-1;for(let e=0;e<this.strands.length;e++)for(let i=0;i<this.strands[e].length-1;i++){const r=f(this.strands[e][i],this.strands[e][i+1],n,t);if(null!==r){let t={x:r.x,y:r.y,bottom:{s:e,v:i},top:{s:this.strands.length-1,v:s}};if(void 0===this.curHeight&&this.crossovers.length%2==0||0===this.curHeight){const e=t.top;t.top=t.bottom,t.bottom=e}this.crossovers.push(t),o=!0}}if(o){this.heights=[];let t=0;for(let e=0;e<this.strands.length;e++){this.heights.push([]);let n=0;const o=this.crossovers.flatMap((t=>[t.bottom])).filter((t=>t.s===e)).map((t=>t.v)).sort(((t,e)=>t-e)),s=this.crossovers.flatMap((t=>[t.top,t.bottom])).filter((t=>t.s===e)).map((t=>t.v)).sort(((t,e)=>t-e));for(let i=0;i<s.length;i++)if(t=o.indexOf(s[i])>=0?0:1,i!=s.length-1)for(;n<(s[i]+s[i+1])/2;n++)this.heights[e][n]=t;for(;n<this.strands[e].length;n++)this.heights[e][n]=t}}}}onmouseup(t){this.cursorDown=!1}onkeydown(t){"t"===t.key&&(this.curHeight=1)}onkeyup(t){"t"===t.key&&(this.curHeight=0)}}class v{constructor(t){this.canvas=t,this.objects=[],this.selectedObject,this.mode=1,this.cursor=new i(0,0,"red",5);const e=this.canvas.width,n=this.canvas.height;this.selectedObject=new x([{x:.25*e,y:.25*n},{x:.75*e,y:.25*n},{x:.75*e,y:.75*n},{x:.25*e,y:.75*n}]),this.objects.push(this.selectedObject),t.onmousemove=t=>{const e=s(t);if(this.cursor.x=e.x,this.cursor.y=e.y,1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onmousemove){const e=new Date;this.selectedObject.onmousemove(t);const n=new Date;n-e>3&&console.log("onmousemove",this.selectedObject.constructor.name,n-e)}2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousemove&&e.onmousemove(t)})),this.draw()},t.onmousedown=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onmousedown(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousedown&&e.onmousedown(t)})),this.draw()},t.onmouseup=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onmouseup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmouseup&&e.onmouseup(t)})),this.draw()},window.onkeyup=t=>{1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onkeyup&&this.selectedObject.onkeyup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onkeyup&&e.onkeyup(t)})),this.draw()},window.onkeydown=t=>{1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onkeydown&&this.selectedObject.onkeydown(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onkeydown&&e.onkeydown(t)})),this.draw()},t.addEventListener("touchstart",t.onmousedown),t.addEventListener("touchend",t.onmouseup),t.addEventListener("touchmove",t.onmousemove)}draw(){var t=this.canvas.getContext("2d");t.fillStyle="#eeeeee",t.strokeStyle="#000000",t.rect(0,0,this.canvas.clientWidth,this.canvas.clientHeight),t.fill();for(const e of this.objects){const n=new Date;e.draw(t);const o=new Date;o-n>3&&console.log("draw",e.constructor.name,o-n)}this.cursor.draw(t)}addObject(t){this.objects.push(t)}}const m=[{x:100,y:100,a:{n:{i:1,x:"a"},c1:{x:114.14213562373095,y:85.85786437626905},c2:{x:29.289321881345245,y:170.71067811865476}},b:{n:{i:2,x:"b"},c1:{x:29.28932188134523,y:29.28932188134526},c2:{x:114.14213562373095,y:114.14213562373095}},top:"a"},{x:150,y:100,a:{n:{i:3,x:"a"},c1:{x:157.07106781186548,y:107.07106781186548},c2:{x:135.85786437626905,y:85.85786437626905}},b:{n:{i:0,x:"b"},c1:{x:135.85786437626905,y:114.14213562373095},c2:{x:164.14213562373095,y:85.85786437626905}},top:"b"},{x:200,y:75,a:{n:{i:1,x:"b"},c1:{x:180.07610603816508,y:76.74311485495318},c2:{x:249.8097349045873,y:70.64221286261707}},b:{n:{i:3,x:"b"},c1:{x:201.7364817766693,y:84.84807753012208},c2:{x:187.84462756331487,y:6.063457289145433}},top:"b"},{x:200,y:125,a:{n:{i:2,x:"a"},c1:{x:259.77168188550473,y:130.2293445648595},c2:{x:190.03805301908255,y:124.12844257252341}},b:{n:{i:0,x:"a"},c1:{x:187.84462756331487,y:193.93654271085455},c2:{x:201.7364817766693,y:115.15192246987792}},top:"a"}];var b=n(72),g=n.n(b),w=n(825),P=n.n(w),M=n(659),j=n.n(M),C=n(56),k=n.n(C),E=n(540),S=n.n(E),z=n(113),O=n.n(z),T=n(523),A={};function D(t,e){const n=t.length,o=new Array(n*n),s=new Array(n),i=new Array(n);for(let e=0;e<n;e++)o[e]=t[e];for(let t=1;t<n;t++)for(let s=0;s<n-t;s++)o[t*n+s]={x:o[(t-1)*n+s].x*e+o[(t-1)*n+(s+1)].x*(1-e),y:o[(t-1)*n+s].y*e+o[(t-1)*n+(s+1)].y*(1-e)};for(let t=0;t<n;t++)s[t]=o[t*n+0];for(let t=n-1;t>=0;t--){const e=n-1-t;i[e]=o[t*n+e]}return[s,i]}function H(t,e){let n,o;for(let s=0;s<1;s+=.01){const i=d(t,I(e,s));(void 0===o||i<o)&&(n=s,o=i)}return n}function I(t,e){if(t.length<4)throw new Error("Need 4 points for bezier curve",t);if(e<0||e>1)throw new Error("t must be in 0, 1",e);return{x:t[0].x*Math.pow(1-e,3)+3*t[1].x*Math.pow(1-e,2)*e+3*t[2].x*(1-e)*Math.pow(e,2)+t[3].x*Math.pow(e,3),y:t[0].y*Math.pow(1-e,3)+3*t[1].y*Math.pow(1-e,2)*e+3*t[2].y*(1-e)*Math.pow(e,2)+t[3].y*Math.pow(e,3)}}function N(t,e,n,o,s,i){return[(n*s-e*i)/(t*s-o*e),(n*o-t*i)/(e*o-t*s)]}A.styleTagTransform=O(),A.setAttributes=k(),A.insert=j().bind(null,"head"),A.domAPI=P(),A.insertStyleElement=S(),g()(T.A,A),T.A&&T.A.locals&&T.A.locals;class L{constructor(t,e){this.knot=t,this.lineWidth=e,this.controlPointSelected=!1,this.selectableControlPoint=void 0,this.curvePinchPoint,this.curvePinchPointSelected=!1,this.curvePinchToCursor}onmousedown(t){void 0!==this.selectableControlPoint&&(this.controlPointSelected=!0),this.curvePinchPoint&&(this.curvePinchPointSelected=!0)}onmouseup(t){this.controlPointSelected=!1,this.curvePinchPointSelected=!1}onmousemove(t){const e=s(t);if(this.curvePinchPointSelected||(this.curvePinchPoint=function(t,e){const n=function(t,e){let n,o,s={i:0,x:"a"};do{const i=t[s.i],r=i[s.x].n,c=t[r.i],h=[i,i[s.x].c1,c[r.x].c2,c],a=H(e,h),u=I(h,a),l=d(e,u);(void 0===n||l<n)&&(o={pt:u,t:a,segment:h,start:{i:s.i,x:s.x},end:{i:r.i,x:r.x}},n=l),s=t[s.i][s.x].n}while(0!==s.i||"a"!==s.x);return o}(t,e);if(d(e,n.pt)<30)return n}(this.knot,e),this.curvePinchPoint&&(this.curvePinchToCursor=h(e,this.curvePinchPoint.pt))),this.curvePinchPointSelected&&this.curvePinchPoint){const t=this.curvePinchPoint.t;this.curvePinchPoint.pt.x=e.x-this.curvePinchToCursor.x,this.curvePinchPoint.pt.y=e.y-this.curvePinchToCursor.y;const n=this.curvePinchPoint.segment,[o,s]=N(3*Math.pow(1-t,2)*t,3*(1-t)*t*t,this.curvePinchPoint.pt.x-n[0].x*Math.pow(1-t,3)-n[3].x*Math.pow(t,3),-1*t/(1-t),1,n[2].x-t*n[1].x/(1-t)),[i,r]=N(3*Math.pow(1-t,2)*t,3*(1-t)*t*t,this.curvePinchPoint.pt.y-n[0].y*Math.pow(1-t,3)-n[3].y*Math.pow(t,3),-1*t,1,n[2].y-t*n[1].y);n[1].x=o,n[1].y=i,n[2].x=s,n[2].y=r;const l=this.knot[this.curvePinchPoint.start.i],f=this.knot[this.curvePinchPoint.start.i][this.curvePinchPoint.start.x].c2,y=a(l,u(-1*d(f,l),c(h(n[1],l))));f.x=y.x,f.y=y.y;const p=this.knot[this.curvePinchPoint.end.i],x=this.knot[this.curvePinchPoint.end.i][this.curvePinchPoint.end.x].c1,v=a(p,u(-1*d(x,p),c(h(n[2],p))));x.x=v.x,x.y=v.y}else if(this.controlPointSelected&&this.selectableControlPoint){this.selectableControlPoint.p.x=e.x,this.selectableControlPoint.p.y=e.y;const t=this.knot[this.selectableControlPoint.i],n=this.knot[this.selectableControlPoint.i][this.selectableControlPoint.x]["c1"===this.selectableControlPoint.c?"c2":"c1"],o=a(t,u(-1*d(n,t),c(h(this.selectableControlPoint.p,t))));n.x=o.x,n.y=o.y}this.selectableControlPoint=void 0;const n=[];for(const t in this.knot){const e=this.knot[t];n.push({p:e.a.c1,i:t,x:"a",c:"c1"}),n.push({p:e.a.c2,i:t,x:"a",c:"c2"}),n.push({p:e.b.c1,i:t,x:"b",c:"c1"}),n.push({p:e.b.c2,i:t,x:"b",c:"c2"})}let o;n.forEach((t=>{const n=d(t.p,e);n<30&&(void 0===o||n<o)&&(this.selectableControlPoint=t,o=n)}))}draw(n){const s=this.knot;for(const t of["bottom","top"]){let e={i:0,x:"a"},i=this.lineWidth,r=8;do{const c=s[e.i],h=c[e.x].n,a=s[h.i],u=c[e.x].c1,l=a[h.x].c2,[d,f]=D([c,u,l,a],.5);(c.top!==e.x&&"bottom"===t||c.top===e.x&&"top"===t)&&(o(n,d,i,"#000000"),o(n,d,i-3,"#ffffff")),(a.top!==h.x&&"bottom"===t||a.top===h.x&&"top"===t)&&(o(n,f,i,"#000000"),o(n,f,i-3,"#ffffff")),e=s[e.i][e.x].n,r--}while((0!==e.i||"a"!==e.x)&&r>0)}for(const o of s){const s=o.a.c1,i=o.a.c2,r=o.b.c1,c=o.b.c2;e(n,o,s,1,"#008800"),t(n,s,3,"#008800"),e(n,o,i,1,"#008800"),t(n,i,3,"#008800"),e(n,o,r,1,"#008800"),t(n,r,3,"#008800"),e(n,o,c,1,"#008800"),t(n,c,3,"#008800")}this.selectableControlPoint&&new i(this.selectableControlPoint.p.x,this.selectableControlPoint.p.y,this.controlPointSelected?"blue":"green",10).draw(n),this.curvePinchPoint&&new i(this.curvePinchPoint.pt.x,this.curvePinchPoint.pt.y,this.curvePinchPointSelected?"blue":"orange",5).draw(n)}}document.body.appendChild(function(){const t=document.createElement("canvas");return t.setAttribute("id","content"),t.width=window.innerWidth,t.height=window.innerHeight,t}()),document.body.setAttribute("style","margin: 0; overflow: hidden"),window.onload=()=>{const t=document.getElementById("content"),e=new v(t);e.addObject(new L(m,20)),e.draw()}})()})();