(()=>{"use strict";var t={523:(t,e,s)=>{s.d(e,{A:()=>c});var n=s(601),o=s.n(n),r=s(314),i=s.n(r)()(o());i.push([t.id,"",""]);const c=i},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",n=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),n&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),n&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,n,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(n)for(var c=0;c<this.length;c++){var h=this[c][0];null!=h&&(i[h]=!0)}for(var a=0;a<t.length;a++){var u=[].concat(t[a]);n&&i[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),s&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=s):u[2]=s),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function s(t){for(var s=-1,n=0;n<e.length;n++)if(e[n].identifier===t){s=n;break}return s}function n(t,n){for(var r={},i=[],c=0;c<t.length;c++){var h=t[c],a=n.base?h[0]+n.base:h[0],u=r[a]||0,d="".concat(a," ").concat(u);r[a]=u+1;var f=s(d),l={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==f)e[f].references++,e[f].updater(l);else{var y=o(l,n);n.byIndex=c,e.splice(c,0,{identifier:d,updater:y,references:1})}i.push(d)}return i}function o(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,o){var r=n(t=t||[],o=o||{});return function(t){t=t||[];for(var i=0;i<r.length;i++){var c=s(r[i]);e[c].references--}for(var h=n(t,o),a=0;a<r.length;a++){var u=s(r[a]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=h}}},659:t=>{var e={};t.exports=function(t,s){var n=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var o=void 0!==s.layer;o&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,o&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={id:n,exports:{}};return t[n](r,r.exports,s),r.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nc=void 0,(()=>{function t(t,e,s,n){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI,!1),t.fillStyle=n,t.fill()}function e(t,e,s,n,o){return function(t,e,s,n){const[o,r,i,c]=e;t.beginPath(),t.moveTo(o.x,o.y),t.lineCap="round",t.lineWidth=s,t.strokeStyle=n,t.bezierCurveTo(r.x,r.y,i.x,i.y,c.x,c.y),t.stroke()}(t,[e,e,s,s],n,o)}function n(t){let e;if(t instanceof TouchEvent)return{x:t.changedTouches?.[0].pageX,y:t.changedTouches?.[0].pageY};if(t instanceof MouseEvent)return e=t.toElement.getBoundingClientRect(),{x:t.clientX-e.left,y:t.clientY-e.top};throw new Error("Unknown event type",t)}class o{constructor(t,e,s,n){this.x=t,this.y=e,this.color=s,this.radius=n}draw(e){t(e,{x:this.x,y:this.y},this.radius,this.color)}}class r{constructor(t){this.canvas=t,this.objects=[],this.selectedObject,this.mode=1,this.cursor=new o(0,0,"red",5),t.onmousemove=t=>{const e=n(t);if(this.cursor.x=e.x,this.cursor.y=e.y,1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onmousemove){const e=new Date;this.selectedObject.onmousemove(t);const s=new Date;s-e>3&&console.log("onmousemove",this.selectedObject.constructor.name,s-e)}2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousemove&&e.onmousemove(t)})),this.draw()},t.onmousedown=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onmousedown(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousedown&&e.onmousedown(t)})),this.draw()},t.onmouseup=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onmouseup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmouseup&&e.onmouseup(t)})),this.draw()},window.onkeyup=t=>{1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onkeyup&&this.selectedObject.onkeyup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onkeyup&&e.onkeyup(t)})),this.draw()},window.onkeydown=t=>{1===this.mode&&this.selectedObject&&"function"==typeof this.selectedObject.onkeydown&&this.selectedObject.onkeydown(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onkeydown&&e.onkeydown(t)})),this.draw()},t.addEventListener("touchstart",t.onmousedown),t.addEventListener("touchend",t.onmouseup),t.addEventListener("touchmove",t.onmousemove)}draw(){var t=this.canvas.getContext("2d");t.fillStyle="#eeeeee",t.strokeStyle="#000000",t.rect(0,0,this.canvas.clientWidth,this.canvas.clientHeight),t.fill();for(const e of this.objects){const s=new Date;e.draw(t);const n=new Date;n-s>10&&console.log("draw",e.constructor.name,n-s)}this.cursor.draw(t)}addObject(t){this.objects.push(t),void 0===this.selectedObject&&(this.selectedObject=t)}}var i=s(72),c=s.n(i),h=s(825),a=s.n(h),u=s(659),d=s.n(u),f=s(56),l=s.n(f),y=s(540),p=s.n(y),m=s(113),v=s.n(m),g=s(523),x={};function w(t,e){return t.x*e.y-t.y*e.x}function b(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z?t.z-e.z:0}}function k(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z?t.z+e.z:0}}function j(t,e){return{x:e.x*t,y:e.y*t,z:e.z?e.z*t:0}}function O(t){return Math.sqrt(t.x*t.x+t.y*t.y+(t.z*t.z||0))}function z(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+((e.z||0)-(t.z||0))*((e.z||0)-(t.z||0)))}function E(t,e,s,n){let o=t,r=b(e,t),i=s,c=b(n,s);if(!function(t,e,s,n){const o=k(t,j(.5,e)),r=k(t,j(.5,e));return!(Math.abs(o.x-r.x)>(Math.abs(e.x)+Math.abs(n.x))/2||Math.abs(o.y-r.y)>(Math.abs(e.y)+Math.abs(n.y))/2)}(o,r,0,c))return null;const h=b(i,o),a=w(r,c),u=w(h,r),d=w(h,c);if(0==w(r,c))return null;if(0==u)return null;let f=d/a,l=u/a;return 0<=f&&f<=1&&0<=l&&l<=1?k(o,j(f,r)):null}function M(t,e,s){const n=function(t,e,s){const n=(r=s,((o=b(t,e)).x*r.x+o.y*r.y+(o.z*r.z||0))/O(s));var o,r;const i=function(t){const e=O(t);return{x:t.x/e,y:t.y/e,z:(t.z||0)/e}}(s);return{x:e.x+i.x*n,y:e.y+i.y*n}}(s,t,b(e,t));let o=(n.x-t.x)/b(e,t).x;return isNaN(o)&&(o=(n.y-t.y)/b(e,t).y),o>1?e:o<0?t:n}function T(t,e){let s,n;for(let o=0;o<t.length;o++){const r=M(t[o],t[(o+1)%t.length],e),i=z(r,e);(void 0===n||i<n)&&(s=r,n=i)}return s}x.styleTagTransform=v(),x.setAttributes=l(),x.insert=d().bind(null,"head"),x.domAPI=a(),x.insertStyleElement=p(),c()(g.A,x),g.A&&g.A.locals&&g.A.locals;class A{constructor(t){this.edge=t,this.width=200,this.height=200,this.strands=[],this.heights=[],this.crossovers=[],this.cursor,this.cursorDown=!1,this.curHeight,this.offset={x:0,y:0}}draw(s){for(let t=0;t<this.edge.length-1;t++)e(s,k(this.offset,this.edge[t]),k(this.offset,this.edge[t+1]),2,"#000000");e(s,k(this.offset,this.edge[this.edge.length-1]),k(this.offset,this.edge[0]),2,"#000000");for(let t=0;t<this.strands.length;t++){for(let n=0;n<this.strands[t].length-1;n++)1!==this.heights[t]?.[n]&&e(s,k(this.offset,this.strands[t][n]),k(this.offset,this.strands[t][n+1]),8,"#000000");for(let n=0;n<this.strands[t].length-1;n++)1!==this.heights[t]?.[n]&&e(s,k(this.offset,this.strands[t][n]),k(this.offset,this.strands[t][n+1]),5,"#ffffff")}for(let t=0;t<this.strands.length;t++){for(let n=0;n<this.strands[t].length-1;n++)1===this.heights[t]?.[n-1]&&1===this.heights[t]?.[n]&&1===this.heights[t]?.[n+1]&&e(s,k(this.offset,this.strands[t][n]),k(this.offset,this.strands[t][n+1]),8,"#000000");for(let n=0;n<this.strands[t].length-1;n++)1===this.heights[t]?.[n]&&e(s,k(this.offset,this.strands[t][n]),k(this.offset,this.strands[t][n+1]),5,"#ffffff")}if(this.cursor){const e=T(this.edge,this.cursor);z(e,this.cursor)<20&&t(s,k(this.offset,e),15,"#0000aa")}}onmousedown(t){const e=T(this.edge,this.cursor);z(e,this.cursor)<20&&(this.cursorDown=!0,this.strands.push([e]))}onmousemove(t){if(this.cursor=b(n(t),this.offset),this.cursorDown){if(!function(t,e){const s={x:Number.MAX_SAFE_INTEGER,y:0};let n=0;for(let o=0;o<e.length;o++)null!==E(e[o],e[(o+1)%e.length],t,k(t,s))&&n++;return n%2==1}(this.cursor,this.edge)){const t=T(this.edge,this.cursor);return void this.addPointToActiveStrand(t)}this.addPointToActiveStrand(this.cursor)}}addPointToActiveStrand(t){const e=this.strands[this.strands.length-1],s=e[e.length-1];var n,o;if(void 0!==s&&(o=s,(n=t).x===o.x&&n.y===o.y&&(n.z||0)===(o.z||0))||e.push({x:t.x,y:t.y}),void 0!==s){let n=!1;const o=e.length-1;for(let e=0;e<this.strands.length;e++)for(let r=0;r<this.strands[e].length-1;r++){const i=E(this.strands[e][r],this.strands[e][r+1],s,t);if(null!==i){let t={x:i.x,y:i.y,bottom:{s:e,v:r},top:{s:this.strands.length-1,v:o}};if(void 0===this.curHeight&&this.crossovers.length%2==0||0===this.curHeight){const e=t.top;t.top=t.bottom,t.bottom=e}this.crossovers.push(t),n=!0}}if(n){this.heights=[];let t=0;for(let e=0;e<this.strands.length;e++){this.heights.push([]);let s=0;const n=this.crossovers.flatMap((t=>[t.bottom])).filter((t=>t.s===e)).map((t=>t.v)).sort(((t,e)=>t-e)),o=this.crossovers.flatMap((t=>[t.top,t.bottom])).filter((t=>t.s===e)).map((t=>t.v)).sort(((t,e)=>t-e));for(let r=0;r<o.length;r++)if(t=n.indexOf(o[r])>=0?0:1,r!=o.length-1)for(;s<(o[r]+o[r+1])/2;s++)this.heights[e][s]=t;for(;s<this.strands[e].length;s++)this.heights[e][s]=t}}}}onmouseup(t){this.cursorDown=!1}onkeydown(t){"t"===t.key&&(this.curHeight=1)}onkeyup(t){"t"===t.key&&(this.curHeight=0)}}class S{constructor(t,e,s,n){if(this.cols=t,this.pallet=s,this.pattern=n,this.offset={x:0,y:0},n.length!=t*e)throw new Error("wrong num elements "+n.length)}draw(t){for(const e in this.pattern){const s=e%this.cols,n=Math.floor(e/this.cols),o=this.pallet[this.pattern[e]];o.offset=k(this.offset,{x:o.width*s,y:o.height*n}),o.draw(t)}}}document.body.appendChild(function(){const t=document.createElement("canvas");return t.setAttribute("id","content"),t.width=window.innerWidth,t.height=window.innerHeight,t}()),document.body.setAttribute("style","margin: 0; overflow: hidden"),window.onload=()=>{const t=document.getElementById("content"),e=new r(t),s=new A([{x:0,y:0},{x:200,y:0},{x:200,y:200},{x:0,y:200}]),n=new S(4,4,{k:s},["k","k","k","k","k","k","k","k","k","k","k","k","k","k","k","k"]);n.offset={x:100,y:100},e.addObject(n),e.selectedObject=s,e.draw()}})()})();