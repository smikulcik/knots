(()=>{"use strict";var t={523:(t,e,o)=>{o.d(e,{A:()=>c});var n=o(601),i=o.n(n),s=o(314),r=o.n(s)()(i());r.push([t.id,"",""]);const c=r},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o="",n=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),n&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),n&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o})).join("")},e.i=function(t,o,n,i,s){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(n)for(var c=0;c<this.length;c++){var h=this[c][0];null!=h&&(r[h]=!0)}for(var a=0;a<t.length;a++){var u=[].concat(t[a]);n&&r[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),o&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=o):u[2]=o),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),e.push(u))}},e}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function o(t){for(var o=-1,n=0;n<e.length;n++)if(e[n].identifier===t){o=n;break}return o}function n(t,n){for(var s={},r=[],c=0;c<t.length;c++){var h=t[c],a=n.base?h[0]+n.base:h[0],u=s[a]||0,l="".concat(a," ").concat(u);s[a]=u+1;var d=o(l),f={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=i(f,n);n.byIndex=c,e.splice(c,0,{identifier:l,updater:p,references:1})}r.push(l)}return r}function i(t,e){var o=e.domAPI(e);return o.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;o.update(t=e)}else o.remove()}}t.exports=function(t,i){var s=n(t=t||[],i=i||{});return function(t){t=t||[];for(var r=0;r<s.length;r++){var c=o(s[r]);e[c].references--}for(var h=n(t,i),a=0;a<s.length;a++){var u=o(s[a]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}s=h}}},659:t=>{var e={};t.exports=function(t,o){var n=function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}e[t]=o}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(o)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,o)=>{t.exports=function(t){var e=o.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(o){!function(t,e,o){var n="";o.supports&&(n+="@supports (".concat(o.supports,") {")),o.media&&(n+="@media ".concat(o.media," {"));var i=void 0!==o.layer;i&&(n+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),n+=o.css,i&&(n+="}"),o.media&&(n+="}"),o.supports&&(n+="}");var s=o.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,o)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,exports:{}};return t[n](s,s.exports,o),s.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.nc=void 0,(()=>{function t(t,e,o,n){t.beginPath(),t.arc(e.x,e.y,o,0,2*Math.PI,!1),t.fillStyle=n,t.fill()}function e(t,e,o,i,s){return n(t,[e,e,o,o],i,s)}function n(t,e,o,n){const[i,s,r,c]=e;t.beginPath(),t.moveTo(i.x,i.y),t.lineCap="round",t.lineWidth=o,t.strokeStyle=n,t.bezierCurveTo(s.x,s.y,r.x,r.y,c.x,c.y),t.stroke()}function i(t){let e;if(t instanceof TouchEvent)return{x:t.changedTouches?.[0].pageX,y:t.changedTouches?.[0].pageY};if(t instanceof MouseEvent)return e=t.toElement.getBoundingClientRect(),{x:t.clientX-e.left,y:t.clientY-e.top};throw new Error("Unknown event type",t)}class s{constructor(t,e,o,n){this.x=t,this.y=e,this.color=o,this.radius=n}draw(e){t(e,{x:this.x,y:this.y},this.radius,this.color)}}function r(t,e){return t.x*e.y-t.y*e.x}function c(t){const e=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+(t.z*t.z||0))}(t);return{x:t.x/e,y:t.y/e,z:(t.z||0)/e}}function h(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z?t.z-e.z:0}}function a(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z?t.z+e.z:0}}function u(t,e){return{x:e.x*t,y:e.y*t,z:e.z?e.z*t:0}}function l(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+((e.z||0)-(t.z||0))*((e.z||0)-(t.z||0)))}function d(t,e,o,n){let i=t,s=h(e,t),c=o,l=h(n,o);if(!function(t,e,o,n){const i=a(t,u(.5,e)),s=a(t,u(.5,e));return!(Math.abs(i.x-s.x)>(Math.abs(e.x)+Math.abs(n.x))/2||Math.abs(i.y-s.y)>(Math.abs(e.y)+Math.abs(n.y))/2)}(i,s,0,l))return null;const d=h(c,i),f=r(s,l),p=r(d,s),v=r(d,l);if(0==r(s,l))return null;if(0==p)return null;let x=v/f,y=p/f;return 0<=x&&x<=1&&0<=y&&y<=1?a(i,u(x,s)):null}class f{constructor(){this.vertices=[],this.heights=[],this.crossovers=[],this.cursor,this.cursorDown=!1}draw(o){for(let t=0;t<this.vertices.length-2;t++)1!==this.heights[t]&&e(o,this.vertices[t],this.vertices[t+1],30,"#000000");for(let t=0;t<this.vertices.length-2;t++)1!==this.heights[t]&&e(o,this.vertices[t],this.vertices[t+1],27,"#ffffff");for(let t=0;t<this.vertices.length-2;t++)1===this.heights[t-1]&&1===this.heights[t]&&1===this.heights[t+1]&&e(o,this.vertices[t],this.vertices[t+1],30,"#000000");for(let t=0;t<this.vertices.length-2;t++)1===this.heights[t]&&e(o,this.vertices[t],this.vertices[t+1],27,"#ffffff");for(let e of this.crossovers){let n="#0000aa";e.top<e.bottom&&(n="#00aa00"),t(o,e,3,n)}}onmousedown(t){this.cursorDown=!0}onmousemove(t){if(this.cursor=i(t),this.cursorDown){const t=this.vertices[this.vertices.length-1];if(void 0===t||(o=t,(e=this.cursor).x!==o.x||e.y!==o.y||(e.z||0)!==(o.z||0))){this.vertices.push({x:this.cursor.x,y:this.cursor.y});let e=!1;const o=this.vertices.length-1;if(this.vertices.length>=3)for(let n=0;n<this.vertices.length-2;n++){const i=d(this.vertices[n],this.vertices[n+1],t,this.cursor);null!==i&&(this.crossovers.push({x:i.x,y:i.y,bottom:this.crossovers.length%2==0?n:o,top:this.crossovers.length%2==0?o:n}),e=!0)}if(e){const t=this.crossovers.flatMap((t=>[t.bottom])).sort(((t,e)=>t-e)),e=this.crossovers.flatMap((t=>[t.top,t.bottom])).sort(((t,e)=>t-e));console.log("adding crossover",t,e),this.heights=[];let o=0,n=0;for(let i=0;i<e.length;i++)if(n=t.indexOf(e[i])>=0?0:1,i!=e.length-1)for(console.log(`${e[i]} v ${o}-${(e[i]+e[i+1])/2} = ${n}`);o<(e[i]+e[i+1])/2;o++)this.heights[o]=n;for(console.log(`v ${o}-${this.vertices.length} = ${n}`);o<this.vertices.length;o++)this.heights[o]=n}}}var e,o}onmouseup(t){this.cursorDown=!1}}class p{constructor(t){this.canvas=t,this.objects=[],this.selectedObject,this.mode=1,this.cursor=new s(0,0,"red",5),t.onmousemove=t=>{const e=i(t);this.cursor.x=e.x,this.cursor.y=e.y,1===this.mode&&this.selectedObject&&this.selectedObject.onmousemove(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousemove&&e.onmousemove(t)})),this.draw()},t.onmousedown=t=>{1===this.mode&&(void 0===this.selectedObject&&(this.selectedObject=new f,this.objects.push(this.selectedObject)),this.selectedObject.onmousedown(t)),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmousedown&&e.onmousedown(t)})),this.draw()},t.onmouseup=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onmouseup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onmouseup&&e.onmouseup(t)})),this.draw()},window.onkeyup=t=>{1===this.mode&&this.selectedObject&&this.selectedObject.onkeyup(t),2===this.mode&&this.objects.forEach((e=>{"function"==typeof e.onkeyup&&e.onkeyup(t)})),this.draw()},t.addEventListener("touchstart",t.onmousedown),t.addEventListener("touchend",t.onmouseup),t.addEventListener("touchmove",t.onmousemove)}draw(){var t=this.canvas.getContext("2d");t.fillStyle="#eeeeee",t.strokeStyle="#000000",t.rect(0,0,this.canvas.clientWidth,this.canvas.clientHeight),t.fill();for(const e of this.objects)e.draw(t);this.cursor.draw(t)}addObject(t){this.objects.push(t)}}const v=[{x:100,y:100,a:{n:{i:1,x:"a"},c1:{x:114.14213562373095,y:85.85786437626905},c2:{x:29.289321881345245,y:170.71067811865476}},b:{n:{i:2,x:"b"},c1:{x:29.28932188134523,y:29.28932188134526},c2:{x:114.14213562373095,y:114.14213562373095}},top:"a"},{x:150,y:100,a:{n:{i:3,x:"a"},c1:{x:157.07106781186548,y:107.07106781186548},c2:{x:135.85786437626905,y:85.85786437626905}},b:{n:{i:0,x:"b"},c1:{x:135.85786437626905,y:114.14213562373095},c2:{x:164.14213562373095,y:85.85786437626905}},top:"b"},{x:200,y:75,a:{n:{i:1,x:"b"},c1:{x:180.07610603816508,y:76.74311485495318},c2:{x:249.8097349045873,y:70.64221286261707}},b:{n:{i:3,x:"b"},c1:{x:201.7364817766693,y:84.84807753012208},c2:{x:187.84462756331487,y:6.063457289145433}},top:"b"},{x:200,y:125,a:{n:{i:2,x:"a"},c1:{x:259.77168188550473,y:130.2293445648595},c2:{x:190.03805301908255,y:124.12844257252341}},b:{n:{i:0,x:"a"},c1:{x:187.84462756331487,y:193.93654271085455},c2:{x:201.7364817766693,y:115.15192246987792}},top:"a"}];var x=o(72),y=o.n(x),b=o(825),m=o.n(b),P=o(659),w=o.n(P),g=o(56),M=o.n(g),C=o(540),j=o.n(C),z=o(113),E=o.n(z),S=o(523),k={};function O(t,e){const o=t.length,n=new Array(o*o),i=new Array(o),s=new Array(o);for(let e=0;e<o;e++)n[e]=t[e];for(let t=1;t<o;t++)for(let i=0;i<o-t;i++)n[t*o+i]={x:n[(t-1)*o+i].x*e+n[(t-1)*o+(i+1)].x*(1-e),y:n[(t-1)*o+i].y*e+n[(t-1)*o+(i+1)].y*(1-e)};for(let t=0;t<o;t++)i[t]=n[t*o+0];for(let t=o-1;t>=0;t--){const e=o-1-t;s[e]=n[t*o+e]}return[i,s]}function T(t,e){let o,n;for(let i=0;i<1;i+=.01){const s=l(t,A(e,i));(void 0===n||s<n)&&(o=i,n=s)}return o}function A(t,e){if(t.length<4)throw new Error("Need 4 points for bezier curve",t);if(e<0||e>1)throw new Error("t must be in 0, 1",e);return{x:t[0].x*Math.pow(1-e,3)+3*t[1].x*Math.pow(1-e,2)*e+3*t[2].x*(1-e)*Math.pow(e,2)+t[3].x*Math.pow(e,3),y:t[0].y*Math.pow(1-e,3)+3*t[1].y*Math.pow(1-e,2)*e+3*t[2].y*(1-e)*Math.pow(e,2)+t[3].y*Math.pow(e,3)}}function I(t,e,o,n,i,s){return[(o*i-e*s)/(t*i-n*e),(o*n-t*s)/(e*n-t*i)]}k.styleTagTransform=E(),k.setAttributes=M(),k.insert=w().bind(null,"head"),k.domAPI=m(),k.insertStyleElement=j(),y()(S.A,k),S.A&&S.A.locals&&S.A.locals;class ${constructor(t,e){this.knot=t,this.lineWidth=e,this.controlPointSelected=!1,this.selectableControlPoint=void 0,this.curvePinchPoint,this.curvePinchPointSelected=!1,this.curvePinchToCursor}onmousedown(t){void 0!==this.selectableControlPoint&&(this.controlPointSelected=!0),this.curvePinchPoint&&(this.curvePinchPointSelected=!0)}onmouseup(t){this.controlPointSelected=!1,this.curvePinchPointSelected=!1}onmousemove(t){const e=i(t);if(this.curvePinchPointSelected||(this.curvePinchPoint=function(t,e){const o=function(t,e){let o,n,i={i:0,x:"a"};do{const s=t[i.i],r=s[i.x].n,c=t[r.i],h=[s,s[i.x].c1,c[r.x].c2,c],a=T(e,h),u=A(h,a),d=l(e,u);(void 0===o||d<o)&&(n={pt:u,t:a,segment:h,start:{i:i.i,x:i.x},end:{i:r.i,x:r.x}},o=d),i=t[i.i][i.x].n}while(0!==i.i||"a"!==i.x);return n}(t,e);if(l(e,o.pt)<30)return o}(this.knot,e),this.curvePinchPoint&&(this.curvePinchToCursor=h(e,this.curvePinchPoint.pt))),this.curvePinchPointSelected&&this.curvePinchPoint){const t=this.curvePinchPoint.t;this.curvePinchPoint.pt.x=e.x-this.curvePinchToCursor.x,this.curvePinchPoint.pt.y=e.y-this.curvePinchToCursor.y;const o=this.curvePinchPoint.segment,[n,i]=I(3*Math.pow(1-t,2)*t,3*(1-t)*t*t,this.curvePinchPoint.pt.x-o[0].x*Math.pow(1-t,3)-o[3].x*Math.pow(t,3),-1*t/(1-t),1,o[2].x-t*o[1].x/(1-t)),[s,r]=I(3*Math.pow(1-t,2)*t,3*(1-t)*t*t,this.curvePinchPoint.pt.y-o[0].y*Math.pow(1-t,3)-o[3].y*Math.pow(t,3),-1*t,1,o[2].y-t*o[1].y);o[1].x=n,o[1].y=s,o[2].x=i,o[2].y=r;const d=this.knot[this.curvePinchPoint.start.i],f=this.knot[this.curvePinchPoint.start.i][this.curvePinchPoint.start.x].c2,p=a(d,u(-1*l(f,d),c(h(o[1],d))));f.x=p.x,f.y=p.y;const v=this.knot[this.curvePinchPoint.end.i],x=this.knot[this.curvePinchPoint.end.i][this.curvePinchPoint.end.x].c1,y=a(v,u(-1*l(x,v),c(h(o[2],v))));x.x=y.x,x.y=y.y}else if(this.controlPointSelected&&this.selectableControlPoint){this.selectableControlPoint.p.x=e.x,this.selectableControlPoint.p.y=e.y;const t=this.knot[this.selectableControlPoint.i],o=this.knot[this.selectableControlPoint.i][this.selectableControlPoint.x]["c1"===this.selectableControlPoint.c?"c2":"c1"],n=a(t,u(-1*l(o,t),c(h(this.selectableControlPoint.p,t))));o.x=n.x,o.y=n.y}this.selectableControlPoint=void 0;const o=[];for(const t in this.knot){const e=this.knot[t];o.push({p:e.a.c1,i:t,x:"a",c:"c1"}),o.push({p:e.a.c2,i:t,x:"a",c:"c2"}),o.push({p:e.b.c1,i:t,x:"b",c:"c1"}),o.push({p:e.b.c2,i:t,x:"b",c:"c2"})}let n;o.forEach((t=>{const o=l(t.p,e);o<30&&(void 0===n||o<n)&&(this.selectableControlPoint=t,n=o)}))}draw(o){const i=this.knot;for(const t of["bottom","top"]){let e={i:0,x:"a"},s=this.lineWidth,r=8;do{const c=i[e.i],h=c[e.x].n,a=i[h.i],u=c[e.x].c1,l=a[h.x].c2,[d,f]=O([c,u,l,a],.5);(c.top!==e.x&&"bottom"===t||c.top===e.x&&"top"===t)&&(n(o,d,s,"#000000"),n(o,d,s-3,"#ffffff")),(a.top!==h.x&&"bottom"===t||a.top===h.x&&"top"===t)&&(n(o,f,s,"#000000"),n(o,f,s-3,"#ffffff")),e=i[e.i][e.x].n,r--}while((0!==e.i||"a"!==e.x)&&r>0)}for(const n of i){const i=n.a.c1,s=n.a.c2,r=n.b.c1,c=n.b.c2;e(o,n,i,1,"#008800"),t(o,i,3,"#008800"),e(o,n,s,1,"#008800"),t(o,s,3,"#008800"),e(o,n,r,1,"#008800"),t(o,r,3,"#008800"),e(o,n,c,1,"#008800"),t(o,c,3,"#008800")}this.selectableControlPoint&&new s(this.selectableControlPoint.p.x,this.selectableControlPoint.p.y,this.controlPointSelected?"blue":"green",10).draw(o),this.curvePinchPoint&&new s(this.curvePinchPoint.pt.x,this.curvePinchPoint.pt.y,this.curvePinchPointSelected?"blue":"orange",5).draw(o)}}document.body.appendChild(function(){const t=document.createElement("canvas");return t.setAttribute("id","content"),t.width=window.innerWidth,t.height=window.innerHeight,t}()),document.body.setAttribute("style","margin: 0; overflow: hidden"),window.onload=()=>{const t=document.getElementById("content"),e=new p(t);e.addObject(new $(v,20)),e.draw()}})()})();